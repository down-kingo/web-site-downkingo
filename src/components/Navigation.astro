---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
import kingoIcon from '../assets/kingo.ico';

interface Props {
    lang?: 'pt' | 'en';
    currentPage?: 'home' | 'download' | 'roadmap' | 'docs' | 'online';
}

const { lang = 'pt', currentPage = 'home' } = Astro.props;

const basePath = lang === 'pt' ? '/pt' : '/en';

const translations = {
    pt: {
        home: 'IN√çCIO',
        download: 'BAIXAR APP',
        online: 'ONLINE',
        roadmap: 'ROADMAP',
        github: 'GITHUB',
    },
    en: {
        home: 'HOME',
        download: 'DOWNLOAD APP',
        online: 'ONLINE',
        roadmap: 'ROADMAP',
        github: 'GITHUB',
    }
};

const t = translations[lang];

const navLinks = [
    { key: 'home', href: `${basePath}/`, label: t.home },
    { key: 'download', href: `${basePath}/download`, label: t.download },
    { key: 'online', href: lang === 'pt' ? `${basePath}/baixar-videos-online` : `${basePath}/online-video-downloader`, label: t.online },
    { key: 'roadmap', href: `${basePath}/#build-in-public`, label: t.roadmap },
];
---

<nav class="fixed top-4 md:top-6 left-1/2 -translate-x-1/2 z-[100] w-[92%] max-w-[400px] md:max-w-2xl transition-all duration-300">
    <div class="glass rounded-full px-4 md:px-6 py-2.5 md:py-3 flex items-center justify-between border border-white/10 bg-[#050505]/80 backdrop-blur-xl shadow-2xl shadow-black/50">
        <a href={`${basePath}/`} class="font-black text-lg tracking-tighter uppercase flex items-center gap-2.5 group">
            <Image src={kingoIcon} alt="DownKingo Logo" width={40} height={40} format="webp" class="w-6 h-6 md:w-5 md:h-5 group-hover:scale-110 transition-transform duration-300" />
            <span class="text-white text-base md:text-lg group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-[#F24E1E] group-hover:via-[#FFC700] group-hover:to-[#1ABCFE] transition-all duration-300">DownKingo</span>
        </a>
        
        <!-- Desktop Menu -->
        <div class="hidden md:flex gap-8 font-mono text-xs font-medium text-white/70">
            {navLinks.map(link => (
                <a 
                    href={link.href} 
                    class:list={[
                        "transition-colors hover:text-white relative after:absolute after:bottom-[-4px] after:left-0 after:h-[1px] after:w-0 after:bg-primary after:transition-all hover:after:w-full",
                        currentPage === link.key ? "text-white after:w-full" : ""
                    ]}
                >
                    {link.label}
                </a>
            ))}
            <a href="https://github.com/down-kingo/downkingo" target="_blank" class="flex items-center gap-1 hover:text-white transition-colors">
                {t.github} <Icon name="lucide:external-link" width={12} />
            </a>
        </div>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden text-white/90 p-1.5 hover:bg-white/10 rounded-full transition-colors active:scale-90" aria-label="Menu">
            <Icon name="lucide:menu" width={22} height={22} />
        </button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="absolute top-[calc(100%+12px)] left-0 right-0 bg-[#0a0a0a]/95 glass border border-white/10 rounded-3xl p-4 flex-col gap-2 hidden origin-top scale-95 opacity-0 transition-all duration-300 shadow-2xl shadow-black/80 ring-1 ring-white/5">
        {navLinks.map(link => (
            <a 
                href={link.href} 
                class:list={[
                    "text-sm font-bold py-3 px-4 rounded-xl transition-all flex items-center justify-between group",
                    currentPage === link.key ? "bg-white/10 text-white" : "text-white/70 hover:text-white hover:bg-white/5"
                ]}
            >
                {link.label}
                <Icon name="lucide:chevron-right" class="opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all text-white/50" width={16} />
            </a>
        ))}
        <div class="h-px bg-white/10 my-1"></div>
        <a href="https://github.com/down-kingo/downkingo" target="_blank" class="text-xs font-mono font-medium text-white/50 py-3 px-4 flex items-center justify-between hover:text-white transition-colors">
            {t.github} <Icon name="lucide:external-link" width={14} />
        </a>
    </div>
</nav>

<script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        let isOpen = false;

        const iconMenu = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>`;
        const iconX = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>`;

        if (btn && menu) {
            btn.addEventListener('click', () => {
                isOpen = !isOpen;
                if (isOpen) {
                    menu.classList.remove('hidden', 'scale-95', 'opacity-0');
                    menu.classList.add('flex', 'scale-100', 'opacity-100');
                    btn.innerHTML = iconX;
                } else {
                    menu.classList.add('hidden', 'scale-95', 'opacity-0');
                    menu.classList.remove('flex', 'scale-100', 'opacity-100');
                    btn.innerHTML = iconMenu;
                }
            });

            // Close on link click
            menu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    isOpen = false;
                    menu.classList.add('hidden', 'scale-95', 'opacity-0');
                    menu.classList.remove('flex', 'scale-100', 'opacity-100');
                    btn.innerHTML = iconMenu;
                });
            });
        }
    });
</script>
