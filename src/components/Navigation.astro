---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
import kingoIcon from '../assets/kingo.ico';

interface Props {
    lang?: 'pt' | 'en';
    currentPage?: 'home' | 'download' | 'roadmap' | 'docs' | 'online' | 'blog';
}

const { lang = 'pt', currentPage = 'home' } = Astro.props;

const basePath = lang === 'pt' ? '/pt' : '';

const translations = {
    pt: {
        home: 'IN√çCIO',
        download: 'BAIXAR APP',
        tools: 'FERRAMENTAS',
        blog: 'BLOG',
        roadmap: 'ROADMAP',
        github: 'GITHUB',
    },
    en: {
        home: 'HOME',
        download: 'DOWNLOAD APP',
        tools: 'TOOLS',
        blog: 'BLOG',
        roadmap: 'ROADMAP',
        github: 'GITHUB',
    }
};

const t = translations[lang];

const navLinks = [
    { key: 'home', href: `${basePath}/`, label: t.home },
    { key: 'download', href: `${basePath}/download/`, label: t.download },
    { key: 'tools', href: lang === 'pt' ? '/pt/ferramentas/' : '/tools/', label: t.tools },
    { key: 'blog', href: `${basePath}/blog/`, label: t.blog },
    { key: 'roadmap', href: `${basePath}/#build-in-public`, label: t.roadmap },
];
---

<nav class="fixed top-4 md:top-6 left-1/2 -translate-x-1/2 z-[100] w-[92%] max-w-[400px] md:max-w-4xl transition-all duration-300">
    <div class="glass rounded-full px-4 md:px-6 py-2.5 md:py-3 flex items-center justify-between border border-white/10 bg-[#050505]/80 backdrop-blur-xl shadow-2xl shadow-black/50">
        <a href={`${basePath}/`} class="font-black text-lg tracking-tighter uppercase flex items-center gap-2.5 group">
            <Image src={kingoIcon} alt="DownKingo Logo" width={40} height={40} format="webp" class="w-6 h-6 md:w-5 md:h-5 group-hover:scale-110 transition-transform duration-300" />
            <span class="text-white text-base md:text-lg group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-[#F24E1E] group-hover:via-[#FFC700] group-hover:to-[#1ABCFE] transition-all duration-300">DownKingo</span>
        </a>
        
        <!-- Desktop Menu -->
        <div class="hidden md:flex gap-6 font-mono text-xs font-medium text-white/70 items-center">
            {navLinks.map(link => {
                const isActive = currentPage === link.key || (link.key === 'blog' && Astro.url.pathname.includes('/blog'));
                return (
                    <a 
                        href={link.href} 
                        class:list={[
                            "transition-colors hover:text-white relative after:absolute after:bottom-[-4px] after:left-0 after:h-[1px] after:w-0 after:bg-primary after:transition-all hover:after:w-full whitespace-nowrap",
                            isActive ? "text-white after:w-full" : ""
                        ]}
                    >
                        {link.label}
                    </a>
                );
            })}
            
            <div class="w-px h-4 bg-white/10 mx-1"></div>

            <a href="https://github.com/down-kingo/downkingo" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1 hover:text-white transition-colors">
                {t.github} <Icon name="lucide:external-link" width={12} />
            </a>
        </div>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden text-white/90 p-1.5 hover:bg-white/10 rounded-full transition-colors active:scale-90" aria-label="Menu">
            <Icon name="lucide:menu" width={22} height={22} />
        </button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="absolute top-[calc(100%+12px)] left-0 right-0 bg-[#0a0a0a]/95 glass border border-white/10 rounded-3xl p-4 flex-col gap-2 hidden origin-top scale-95 opacity-0 transition-all duration-300 shadow-2xl shadow-black/80 ring-1 ring-white/5">
        {navLinks.map(link => (
            <a 
                href={link.href} 
                class:list={[
                    "text-sm font-bold py-3 px-4 rounded-xl transition-all flex items-center justify-between group",
                    currentPage === link.key ? "bg-white/10 text-white" : "text-white/70 hover:text-white hover:bg-white/5"
                ]}
            >
                {link.label}
                <Icon name="lucide:chevron-right" class="opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all text-white/50" width={16} />
            </a>
        ))}
        
        <a href="https://github.com/down-kingo/downkingo" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 hover:text-white transition-colors border-b border-white/5 pb-4">
            {t.github} <Icon name="lucide:external-link" width={16} />
        </a>
    </div>
</nav>

<script>
    document.addEventListener('astro:page-load', () => {
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        const links = menu ? menu.querySelectorAll('a') : [];
        let isOpen = false;

        const iconMenu = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>`;
        const iconX = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>`;

        // Function to toggle menu state
        function toggleMenu() {
            if (!btn || !menu) return;
            
            isOpen = !isOpen;
            if (isOpen) {
                menu.classList.remove('hidden', 'scale-95', 'opacity-0');
                menu.classList.add('flex', 'scale-100', 'opacity-100');
                btn.innerHTML = iconX;
                btn.classList.add('bg-white/10');
            } else {
                menu.classList.add('hidden', 'scale-95', 'opacity-0');
                menu.classList.remove('flex', 'scale-100', 'opacity-100');
                btn.innerHTML = iconMenu;
                btn.classList.remove('bg-white/10');
            }
        }

        // Cleanup old listeners (optional safety, though astro:page-load handles cleanup mostly by DOM replacement)
        // Add new listener
        if (btn) {
            btn.onclick = (e) => {
                e.stopPropagation();
                toggleMenu();
            };
        }

        // Close when clicking outside
        document.addEventListener('click', (e) => {
            if (isOpen && menu && !menu.contains(e.target) && !btn.contains(e.target)) {
                toggleMenu();
            }
        });

        // Close when clicking links
        links.forEach(link => {
            link.addEventListener('click', () => {
                if (isOpen) toggleMenu();
            });
        });
    });
</script>
